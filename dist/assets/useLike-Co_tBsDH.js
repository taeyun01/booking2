import{g as l,G as m,H as h,a3 as i,c as d,C as c,s as r,K as g,w,a4 as L,J as f,d as I,u as E,P as y,M as k,q as C}from"./index-Cer2pxi4.js";import{a as K,u as O}from"./useAlert-CwV4OKQA.js";const v=async({userId:e})=>(await l(m(d(r,c.LIKE),i("userId","==",e),h("order","asc")))).docs.map(a=>({id:a.id,...a.data()})),S=async({hotel:e,userId:t})=>{const a=await l(m(d(r,c.LIKE),i("userId","==",t),i("hotelId","==",e.id)));if(a.docs.length>0){const s=a.docs[0],u=s.data().order,o=await l(m(d(r,c.LIKE),i("userId","==",t),i("order",">",u)));if(o.empty)return await g(s.ref);{const n=w(r);return o.forEach(p=>{n.update(p.ref,{order:p.data().order-1})}),await n.commit(),await g(s.ref)}}else{const s=await l(m(d(r,c.LIKE),i("userId","==",t),h("order","desc"),L(1))),o={order:(s.empty?0:s.docs[0].data().order)+1,hotelId:e.id,hotelName:e.name,hotelMainImageUrl:e.mainImageUrl,userId:t};return f(I(d(r,c.LIKE)),o)}},b=e=>{const t=w(r);return e.forEach(a=>{t.update(I(d(r,c.LIKE),a.id),{order:a.order})}),t.commit()},q=()=>{const e=E(),t=K(),a=y(),s=k(),{data:u}=C(["likes"],()=>v({userId:e==null?void 0:e.uid}),{enabled:!!e,suspense:!0}),{mutate:o}=O(({hotel:n})=>{if(e===null)throw new Error("로그인 필요");return S({hotel:n,userId:e.uid})},{onSuccess:()=>{s.invalidateQueries(["likes"])},onError:n=>{if(n.message==="로그인 필요"){t({title:"로그인이 필요한 기능입니다.",onButtonClick:()=>{a("/signin")}});return}t({title:"알 수 없는 에러가 발생했습니다. 잠시후 다시 시도해주세요.",onButtonClick:()=>{}})}});return{data:u,mutate:o}};export{b as a,q as u};
